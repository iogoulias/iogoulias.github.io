<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">

  <title>ðŸŽ§ Airwaves</title>

  <script type="module">
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js" integrity="sha512-YsR46MmyChktsyMMou+Bs74oCa/CDdwft7rJ5wlnmDzMj1mzqncsfJamEEf99Nk7IB0JpTMo5hS8rxB49FUktQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/print.css" media="print"> -->

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ§</text></svg>">

  <meta name="description" content="MP3 Player for Google Drive">
  <meta property="og:title" content="ðŸŽ§ Airwaves">
  <meta property="og:description" content="MP3 Player for Google Drive">
  <!-- <meta property="og:image" content="https://www.mywebsite.com/image.jpg">
  <meta property="og:image:alt" content="Image description"> -->
  <meta property="og:locale" content="en_GB">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- <meta property="og:url" content="https://www.mywebsite.com/page">
  <link rel="canonical" href="https://www.mywebsite.com/page"> -->

  <!-- <link rel="icon" href="/favicon.ico">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/my.webmanifest"> -->
  <meta name="theme-color" content="#E52E4D">

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">

  <style>

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body {
	line-height: 1;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}

*, *:before, *:after {
  box-sizing: border-box;
}

    body {
      font-family: 'Space Mono', monospace;
      min-width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow-x:  hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2rem;
      width: 80%;
      min-width: 320px;
      max-width: 520px;
    }

    audio {
      width: 100%;
    }

    #results,
    #results ul,
    #results ul dl {
      width: 100%;
    }

    #results ul {
      /* max-height: 80vh;
      overflow-x: hidden;
      overflow-y: auto; */
    }

    li {
      list-style-type: none;
    }

    ul > li {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      justify-content: space-between;;
      padding: .5rem;
      line-height: 1.45;
    }

    ul > li:nth-child(odd) {
      background: rgba(0,0,0,.02);
    }

    ul dl {
      flex-grow: 1;
      padding: 1rem;
      /* max-width: 200px; */
      overflow: hidden;
    }

    dl li {

    }

    .title {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;  
      overflow: hidden;
      max-width: 100%;
    }

    .album {
      font-size: .8em;
      opacity :.7;
    }

    ul button {
      padding: 1rem 2rem;
    }

    #form {
      display: flex;
      width: 100%;
      gap: 1rem;
    }

    #form > * {
      height: 3rem;
      padding: 0 1rem;
    }

    input, button, audio {
      font-family: inherit;
    }

    input[type="search"] {
      flex-grow: 1;
    }

    .player {
      width: 100%;
      position: sticky;
      padding: .5rem;
      background: white;
      top: 0;
      z-index: 1;
    }


  </style>
</head>
  
  
<body>
     
    <div class="container">
    
  <figure class="player">
    <figcaption></figcaption>
    <audio id="audio" controls><source src="https://docs.google.com/uc?export=download&amp;id=1kVzNfbHfhSjwRHbEckQjclfzHFqcuL7G" id="source"></audio>
    <div>
      <button type="button" class="skipForward" onclick="audioForward()">+15</button>
      <button type="button" class="skipBackward" onclick="audioBackward()">-15</button>
    </div>
  </figure>
  <form id="form" onsubmit="search(event)">
    <input id="input" type="search"></input>
    <button type="submit">Search</button>
  </form>

  <div id="results"></div>

  <h3>

  </h3>
  <ul>
    <li></li>
  </ul>

</div>

<script type="text/javascript">
  //      var url_string = location.href
  //      var url = new URL(url_string);
  //      var song = url.searchParams.get("song");
   //     var audio = document.getElementById('audio');
  //var source = document.createElement('source');
  
  //source.setAttribute('src', song);
  
  //audio.appendChild(source);

  var audio = document.getElementById('audio');
  var source = document.createElement('source');

  function searchAirtable(searchTerm) {
      fetch("https://api.airtable.com/v0/app6GHxtqv6bp7oBk/tracks?api_key=keyll8LpyyN3adHhR&filterByFormula="+encodeURIComponent('OR(SEARCH(LOWER("'+searchTerm+'"),LOWER({Track Name}))>0,SEARCH(LOWER("'+searchTerm+'"),LOWER(Artist))>0,SEARCH(LOWER("'+searchTerm+'"),LOWER({File Name}))>0,SEARCH(LOWER("'+searchTerm+'"),LOWER(Album))>0)'))
      .then((res) => res.json())
      .then((data) => {
        //setRecipes(data.records);
        console.log(data);
       var ul=[];
        for (var i=0;i<data.records.length;i++) {
         var lientry="<li><dl>"
        // for (var key in data.records[i]["fields"]) {
        // lientry=lientry+" <b>"+key+"</b>: "+data.records[i]["fields"][key];
        // }
          lientry=lientry+"<li class='title'>"+data.records[i]["fields"]["Title"]+"</li>";
          lientry=lientry+"<li class='album'>"+data.records[i]["fields"]["Album"]+"</li>";
  
          lientry=lientry+"</dl><button onclick=\"play('"+data.records[i]["fields"]["File ID"]+"')\">Play</button>"+"</li>";
          ul.push(lientry);
        }
      
      var audio = document.getElementById('results');
      audio.innerHTML="<ul>"+ul.join("")+"</ul>";
      
      })
      .catch((error) => {
        console.log(error);
      });
  }

  function search(event) {
    event.preventDefault();
    var input = document.getElementById('input').value;
    searchAirtable(input);
  }

  function play(id) {
    try {
      var oldsource = document.getElementById('source').remove();
    } catch (e) {}
    
    console.log(fetchArtwork(id))
    source.setAttribute('src', "https://docs.google.com/uc?export=download&id="+id);
    source.setAttribute('id', "source");
    audio.appendChild(source);

    document.getElementById("audio").load();
    document.getElementById("audio").play();
  } 
  
  window.onload = function() {
    document.getElementById("input").focus();
  };
  
  var form = document.getElementById("form");
  
  function handleForm(event) { 
    event.preventDefault();
    search();
  }
  
audio.onended = (event) => {
  console.log('Video stopped either because 1) it was over, ' +
      'or 2) no further data is available.');

    fetch("https://api.airtable.com/v0/app6GHxtqv6bp7oBk/tracks?api_key=keyll8LpyyN3adHhR")
      .then((res) => res.json())
      .then((data) => {
        //setRecipes(data.records);
        console.log(data.records.length);
      //  var ul=[];
      //   for (var i=0;i<data.records.length;i++) {
      //    var lientry="<li><dl>"
      //   // for (var key in data.records[i]["fields"]) {
      //   // lientry=lientry+" <b>"+key+"</b>: "+data.records[i]["fields"][key];
      //   // }
      //     lientry=lientry+"<li class='title'>"+data.records[i]["fields"]["Title"]+"</li>";
      //     lientry=lientry+"<li class='album'>"+data.records[i]["fields"]["Album"]+"</li>";
  
      //     lientry=lientry+"</dl><button onclick=\"play('"+data.records[i]["fields"]["File ID"]+"')\">Play</button>"+"</li>";
      //     ul.push(lientry);
      //   }
      
      // var audio = document.getElementById('results');
      // audio.innerHTML="<ul>"+ul.join("")+"</ul>";
      
      })
      .catch((error) => {
        console.log(error);
      });

  // count all records
  // generate random number between 1 and $count
  // play(fileID)
};

function audioForward() {
  audio.currentTime += 15.0;
}

function audioBackward() {
  audio.currentTime -= 15.0;
}
function fetchArtwork(id) {
var jsmediatags = window.jsmediatags;

jsmediatags.read("https://docs.google.com/uc?export=download&id="+id, {
  onSuccess: function(tag) {

    var image = tag.tags.picture;

      if (image) {
        var base64String = "";
        for (var i = 0; i < image.data.length; i++) {
            base64String += String.fromCharCode(image.data[i]);
        }
        var base64 = "data:" + image.format + ";base64," +
                window.btoa(base64String);
        return base64
		   }

       else {
       return null;
      }
  },
  onError: function(error) {
    console.log(error);
	return null
  }
  
});
}

</script>

</body>
  
</html>
